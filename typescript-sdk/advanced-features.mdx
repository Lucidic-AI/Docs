---
title: Advanced Features
description: Multimodal support, data masking, prompt management, and more
---

# Advanced Features

The TypeScript SDK includes powerful features beyond basic tracking to help you build production-ready AI applications.

---

## Multimodal Support

The SDK automatically handles text and image inputs for supported providers.

### Automatic Image Tracking

```typescript
import { LucidicAI } from 'lucidicai';
import OpenAI from 'openai';

const client = new LucidicAI({ apiKey: '...', providers: ['openai'] });
const openai = new OpenAI();

await client.sessions.create({ sessionName: 'Image Analysis' }, async () => {
    // Images in OpenAI calls are automatically tracked
    const response = await openai.chat.completions.create({
        model: 'gpt-4-vision-preview',
        messages: [{
            role: 'user',
            content: [
                { type: 'text', text: 'Describe this chart' },
                {
                    type: 'image_url',
                    image_url: { url: 'data:image/png;base64,iVBORw0...' }
                }
            ]
        }]
    });

    // The image is automatically:
    // - Extracted from the request
    // - Uploaded to Lucidic storage
    // - Linked to the event
});
```

---

## Data Masking

Protect sensitive information before it's sent to Lucidic.

### Built-in Masking

```typescript
import { LucidicAI } from 'lucidicai';

const client = new LucidicAI({
    apiKey: '...',
    providers: ['openai']
});

await client.sessions.create({
    sessionName: 'Secure Session',
    maskingFunction: (text: string) => {
        return text
            // Mask SSNs
            .replace(/\b\d{3}-\d{2}-\d{4}\b/g, '***-**-****')
            // Mask emails
            .replace(/\b[\w.-]+@[\w.-]+\.\w+\b/g, '***@***.***')
            // Mask credit cards
            .replace(/\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}\b/g, '**** **** **** ****')
            // Mask API keys
            .replace(/\b(sk-|api-|key-)[a-zA-Z0-9]{20,}\b/g, '$1***');
    }
}, async () => {
    // All data in this session will be masked
});
```

### Custom Masking Rules

```typescript
interface SensitiveData {
    userId: string;
    accountNumber: string;
    apiKey: string;
}

await client.sessions.create({
    sessionName: 'Custom Masking',
    maskingFunction: (text: string) => {
        // Parse and mask JSON
        try {
            const data = JSON.parse(text);
            if (data.accountNumber) {
                data.accountNumber = '***MASKED***';
            }
            if (data.apiKey) {
                data.apiKey = data.apiKey.substring(0, 8) + '***';
            }
            return JSON.stringify(data);
        } catch {
            // Not JSON, apply text masks
            return text.replace(/Account: \d+/g, 'Account: ***');
        }
    }
}, async () => {
    // Your workflow
});
```

---

## Prompt Management

Fetch and cache prompts from the Lucidic platform.

### Basic Prompt Fetching

```typescript
import { LucidicAI } from 'lucidicai';
import OpenAI from 'openai';

const client = new LucidicAI({ apiKey: '...', providers: ['openai'] });
const openai = new OpenAI();

await client.sessions.create({ sessionName: 'Prompt Demo' }, async () => {
    // Fetch a prompt (cached by default)
    const prompt = await client.prompts.get({
        promptName: 'customer-support-prompt'
    });

    // Use in your LLM call
    const response = await openai.chat.completions.create({
        model: 'gpt-4',
        messages: [
            { role: 'system', content: prompt },
            { role: 'user', content: userMessage }
        ]
    });
});
```

### Cache Control

```typescript
// Always fetch fresh
const freshPrompt = await client.prompts.get({
    promptName: 'dynamic-prompt',
    cacheTtl: 0
});

// Cache for 5 minutes (default)
const cachedPrompt = await client.prompts.get({
    promptName: 'stable-prompt',
    cacheTtl: 300
});
```

### Prompt Versioning

In the Lucidic dashboard, you can:
- Create multiple versions of prompts
- A/B test different versions
- Roll back to previous versions
- Track which version was used in each session

---

## Session Tags and Metadata

Add custom metadata to sessions for better organization.

```typescript
import { LucidicAI } from 'lucidicai';

const client = new LucidicAI({ apiKey: '...', providers: ['openai'] });

// During initialization
await client.sessions.create({
    sessionName: 'Customer Chat',
    tags: ['priority:high', 'department:technical', 'issueType:bug']
}, async () => {
    // Your workflow

    // Update tags during session
    await client.sessions.update({
        tags: ['priority:high', 'department:technical', 'issueType:bug', 'resolved:true']
    });
});
```

---

## Automatic Features Summary

The TypeScript SDK includes these automatic behaviors:

### 1. Auto Session Management

```typescript
// Sessions auto-end when callback completes
await client.sessions.create({ sessionName: 'Auto-cleanup' }, async () => {
    // ... do work ...
}); // Session ends automatically here
```

### 2. Auto Event Creation

```typescript
// Every LLM call becomes an event automatically
// No manual event creation needed for supported providers
const response = await openai.chat.completions.create({
    model: 'gpt-4',
    messages: [{ role: 'user', content: 'Hello!' }]
});
// Event created automatically with inputs, outputs, tokens, cost, timing
```

### 3. Auto Cost Calculation

Costs are calculated based on:
- Model used
- Token counts (input and output)
- Built-in pricing data for supported models

### 4. Auto Error Tracking

```typescript
await client.sessions.create({ sessionName: 'Error Tracking' }, async () => {
    throw new Error('Something went wrong');
    // Error is automatically captured as an event with stack trace
});
```

---

## Error Handling

The SDK provides specific error types for better error handling:

```typescript
import { LucidicAI, APIError } from 'lucidicai';

try {
    const client = new LucidicAI({ apiKey: 'invalid' });

    await client.sessions.create({ sessionName: 'Test' }, async () => {
        // Your workflow
    });
} catch (error) {
    if (error instanceof APIError) {
        console.error('API error:', error.message);
        // Handle network issues, server errors, etc.
    }
}
```

---

## Performance Considerations

### Batching and Async Operations

```typescript
await client.sessions.create({ sessionName: 'Parallel Work' }, async () => {
    // Good: Parallel operations
    const [analysis, summary, translation] = await Promise.all([
        analyzeText(content),
        summarizeText(content),
        translateText(content)
    ]);

    // Each LLM call is tracked independently as nested events
});
```

### High-Frequency Event Tracking

```typescript
await client.sessions.create({ sessionName: 'Batch Processing' }, async () => {
    // Use emit() for high-frequency events - zero latency impact
    for (const item of largeDataset) {
        client.events.emit({
            name: 'Item processed',
            input: { id: item.id },
            output: { success: true }
        });
        await processItem(item);
    }
});
```

### Memory Management

```typescript
// For long-running processes, consider splitting into multiple sessions
async function longRunningProcess() {
    const checkpoints = ['phase1', 'phase2', 'phase3'];

    for (const phase of checkpoints) {
        await client.sessions.create({
            sessionName: `Long process - ${phase}`,
            tags: ['long-running', phase]
        }, async () => {
            await processPhase(phase);
        });
        // Each phase gets its own session for better organization
    }
}
```

---

## Next Steps

- [API Reference](/typescript-sdk/index) - Complete function documentation
- [Examples](/typescript-sdk/examples) - Real-world implementations

---
